var workly=function(){'use strict';function a(b,c){return c=c||[],new Proxy(function(){},{get(d,e,f){if('then'===e){if(0===c.length)return{then:()=>f};const a=b.remote({type:'GET',path:c});return a.then.bind(a)}return a(b,c.concat(e))},set(a,d,e){return b.remote({type:'SET',path:c.concat(d),value:e})},apply(a,d,e){return b.remote({type:'APPLY',path:c,args:e})},construct(a,c){return b.remote({type:'CONSTRUCT',args:c})}})}function b(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}function c(a){const c={},d=(a)=>{const d=`${Date.now()}-${b()}`;return c[d]=a,d};self.addEventListener('message',async(b)=>{let e=b.data||{};e.path=e.path||[];let f=e.target&&c[e.target]||a;const g=(a)=>a.reduce((a,b)=>a?a[b]:a,f),h=e&&e.id;if(h&&e.type){const a={id:h},b=g(e.path),c=g(e.path.slice(0,-1));switch(e.type){case'GET':a.value=b;break;case'SET':let f=e.path.length&&e.path[e.path.length-1];f&&(c[f]=e.value),a.value=!!f;break;case'APPLY':try{a.value=await b.apply(c,e.args||[])}catch(b){a.error=b.toString()}break;case'CONSTRUCT':try{a.value=new b(...e.args),a.targetId=d(a.value)}catch(b){a.error=b.toString()}}self.postMessage(a)}})}class d{constructor(c,e){this.w=c,this.uid=e||`${Date.now()}-${b()}`,this.c=0,this.cbs={},c.addEventListener('message',(b)=>{if(this.w.oURL)try{URL.revokeObjectURL(this.w.oURL)}catch(a){}finally{delete this.w.oURL}let e=b.data&&b.data.id,f=e&&this.cbs[e];f&&(delete this.cbs[e],b.data.error?f[1](new Error(b.data.error)):f[0](b.data.targetId?a(new d(c,b.data.targetId)):b.data.value))})}remote(a){const b=a.args||[],c=`${this.uid}-${++this.c}`;return new Promise((d,e)=>{this.cbs[c]=[d,e],this.w.postMessage(Object.assign({},a,{id:c,args:b,target:this.uid}))})}}return function(e){let f,g;if('function'==typeof e){const a=Function.prototype.toString;f=g=URL.createObjectURL(new Blob([`${a.call(b)}\n(${a.call(c)})(${a.call(e)})`]))}else'string'==typeof e&&(f=e);if(f){let b=new Worker(f);return g&&(b.oURL=g),a(new d(b))}throw'Workly only supports functions, classes, urls'}}();